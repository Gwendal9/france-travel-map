<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Carte de France Interactive</title>
    <!-- Updated: 2026-01-22 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Map styling - clean and modern */
        .map-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            position: relative;
        }
        
        .department-path {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            stroke-width: 2;
        }

        .department-path:hover {
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.25)) brightness(1.15);
            transform: scale(1.02);
            stroke-width: 3;
            z-index: 10;
        }

        .department-path:active {
            transform: scale(0.98);
        }
        
        /* City markers with glow */
        .city-marker {
            filter: drop-shadow(0 0 3px rgba(231, 76, 60, 0.6));
            cursor: pointer;
        }
        
        /* Rating bar */
        .rating-bar {
            cursor: pointer;
        }

        .rating-bar:hover {
            transform: scaleY(1.05);
        }

        /* Department detail overlay - simplified */
        .department-overlay {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .department-map-full {
            width: 95%;
            height: 95%;
            max-width: 1400px;
            max-height: 900px;
            background: white;
            border-radius: 2rem;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            padding: 3rem;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .city-label {
            font-size: 14px;
            font-weight: 600;
            fill: #1f2937;
            text-shadow: 0 0 3px white, 0 0 6px white;
            pointer-events: none;
        }

        .department-tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            pointer-events: none;
            z-index: 1000;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.2s ease;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const GEOJSON_URL = 'https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/departements-version-simplifiee.geojson';

        // Real GPS coordinates for major cities [longitude, latitude]
        const CITY_COORDINATES = {
          // Auvergne-Rh√¥ne-Alpes
          'Bourg-en-Bresse': [5.2281, 46.2056],
          'Moulins': [3.3333, 46.5667],
          'Vichy': [3.4267, 46.1278],
          'Privas': [4.5994, 44.7353],
          'Gap': [6.0806, 44.5594],
          'Valence': [4.8917, 44.9333],
          'Grenoble': [5.7245, 45.1885],
          'Saint-√âtienne': [4.3872, 45.4397],
          'Le Puy-en-Velay': [3.8836, 45.0433],
          'Aurillac': [2.4392, 44.9261],
          'Clermont-Ferrand': [3.0833, 45.7772],
          'Lyon': [4.8357, 45.7640],
          'Chamb√©ry': [5.9175, 45.5646],
          'Annecy': [6.1294, 45.8992],

          // Bourgogne-Franche-Comt√©
          'Dijon': [5.0417, 47.3220],
          'Besan√ßon': [6.0244, 47.2378],
          'Lons-le-Saunier': [5.5542, 46.6753],
          'Nevers': [3.1586, 46.9897],
          'Vesoul': [6.1542, 47.6228],
          'M√¢con': [4.8331, 46.3067],
          'Auxerre': [3.5697, 47.7981],
          'Belfort': [6.8628, 47.6383],

          // Bretagne
          'Saint-Brieuc': [-2.7608, 48.5139],
          'Brest': [-4.4861, 48.3900],
          'Quimper': [-4.0978, 47.9960],
          'Rennes': [-1.6778, 48.1173],
          'Vannes': [-2.7597, 47.6578],

          // Centre-Val de Loire
          'Bourges': [2.3964, 47.0844],
          'Chartres': [1.4878, 48.4469],
          'Ch√¢teauroux': [1.6914, 46.8117],
          'Tours': [0.6892, 47.3941],
          'Blois': [1.3289, 47.5867],
          'Orl√©ans': [1.9042, 47.9029],

          // Corse
          'Ajaccio': [8.7369, 41.9267],
          'Porto-Vecchio': [9.2789, 41.5914],
          'Propriano': [8.9042, 41.6767],
          'Sart√®ne': [8.9728, 41.6222],
          'Bonifacio': [9.1594, 41.3874],
          'Bastia': [9.4500, 42.7028],
          'Corte': [9.1500, 42.3067],
          'Calvi': [8.7561, 42.5678],
          'L\'√éle-Rousse': [8.9378, 42.6378],
          'Biguglia': [9.4328, 42.6106],

          // Grand Est
          'Charleville-M√©zi√®res': [4.7197, 49.7722],
          'Troyes': [4.0786, 48.2972],
          'Reims': [4.0317, 49.2583],
          'Ch√¢lons-en-Champagne': [4.3631, 48.9575],
          'Chaumont': [5.1389, 48.1111],
          'Nancy': [6.1839, 48.6921],
          'Bar-le-Duc': [5.1603, 48.7708],
          'Metz': [6.1758, 49.1193],
          'Strasbourg': [7.7521, 48.5734],
          'Colmar': [7.3581, 48.0778],
          '√âpinal': [6.4497, 48.1731],

          // Hauts-de-France
          'Laon': [3.6250, 49.5639],
          'Lille': [3.0573, 50.6292],
          'Beauvais': [2.0839, 49.4295],
          'Arras': [2.7733, 50.2917],
          'Amiens': [2.2958, 49.8942],

          // √éle-de-France
          'Paris': [2.3522, 48.8566],
          'Melun': [2.6597, 48.5392],
          'Versailles': [2.1301, 48.8014],
          '√âvry-Courcouronnes': [2.4289, 48.6281],
          'Nanterre': [2.2069, 48.8925],
          'Bobigny': [2.4394, 48.9075],
          'Cr√©teil': [2.4656, 48.7908],
          'Cergy': [2.0772, 49.0369],

          // Normandie
          'Caen': [-0.3708, 49.1829],
          '√âvreux': [1.1508, 49.0242],
          'Saint-L√¥': [-1.0911, 49.1153],
          'Alen√ßon': [0.0894, 48.4328],
          'Rouen': [1.0993, 49.4432],

          // Nouvelle-Aquitaine
          'Angoul√™me': [0.1608, 45.6484],
          'La Rochelle': [-1.1508, 46.1603],
          'Tulle': [1.7667, 45.2667],
          'Gu√©ret': [1.8706, 46.1700],
          'P√©rigueux': [0.7211, 45.1844],
          'Bordeaux': [-0.5792, 44.8378],
          'Mont-de-Marsan': [-0.5000, 43.8900],
          'Agen': [0.6211, 44.2028],
          'Cahors': [1.4411, 44.4481],
          'Pau': [-0.3706, 43.2964],
          'Niort': [-0.4597, 46.3236],
          'Poitiers': [0.3333, 46.5833],
          'Limoges': [1.2578, 45.8336],

          // Occitanie
          'Foix': [1.6058, 42.9656],
          'Carcassonne': [2.3492, 43.2130],
          'Rodez': [2.5753, 44.3508],
          'N√Æmes': [4.3608, 43.8367],
          'Toulouse': [1.4442, 43.6047],
          'Auch': [0.5850, 43.6461],
          'Montpellier': [3.8767, 43.6108],
          'Mende': [3.5006, 44.5181],
          'Tarbes': [0.0800, 43.2333],
          'Perpignan': [2.8954, 42.6886],
          'Albi': [2.1481, 43.9289],
          'Montauban': [1.3556, 44.0178],

          // Pays de la Loire
          'Nantes': [-1.5536, 47.2184],
          'Angers': [-0.5633, 47.4784],
          'Laval': [-0.7703, 48.0694],
          'Le Mans': [0.1996, 47.9952],
          'La Roche-sur-Yon': [-1.4328, 46.6703],

          // Provence-Alpes-C√¥te d'Azur
          'Digne-les-Bains': [6.2361, 44.0936],
          'Brian√ßon': [6.6408, 44.8997],
          'Nice': [7.2619, 43.7102],
          'Marseille': [5.3698, 43.2965],
          'Toulon': [5.9280, 43.1242],
          'Avignon': [4.8075, 43.9493],

          // Other major cities
          'Cannes': [7.0169, 43.5528],
          'Antibes': [7.1258, 43.5808],
          'Aix-en-Provence': [5.4474, 43.5297],
          'B√©ziers': [3.2147, 43.3442],
          'S√®te': [3.6972, 43.4031],
          'Lourdes': [-0.0467, 43.0933],
          'Bayonne': [-1.4747, 43.4928],
          'Biarritz': [-1.5586, 43.4808],
          'Le Havre': [0.1078, 49.4944],
          'Tourcoing': [3.1606, 50.7236],
          'Roubaix': [3.1739, 50.6942],
          'Dunkerque': [2.3772, 51.0342],
          'Mulhouse': [7.3389, 47.7508]
        };

        const departmentInfo = {
          '01': { name: 'Ain', cities: ['Bourg-en-Bresse', 'Oyonnax', 'Belley', 'Gex', 'Nantua'] },
          '02': { name: 'Aisne', cities: ['Laon', 'Saint-Quentin', 'Soissons', 'Ch√¢teau-Thierry', 'Vervins'] },
          '03': { name: 'Allier', cities: ['Moulins', 'Vichy', 'Montlu√ßon', 'Cusset', 'Yzeure'] },
          '04': { name: 'Alpes-de-Haute-Provence', cities: ['Digne-les-Bains', 'Manosque', 'Sisteron', 'Barcelonnette', 'Castellane'] },
          '05': { name: 'Hautes-Alpes', cities: ['Gap', 'Brian√ßon', 'Embrun', 'L\'Argenti√®re-la-Bess√©e', 'Tallard'] },
          '06': { name: 'Alpes-Maritimes', cities: ['Nice', 'Cannes', 'Antibes', 'Grasse', 'Menton'] },
          '07': { name: 'Ard√®che', cities: ['Privas', 'Annonay', 'Aubenas', 'Tournon-sur-Rh√¥ne', 'Guilherand-Granges'] },
          '08': { name: 'Ardennes', cities: ['Charleville-M√©zi√®res', 'Sedan', 'Rethel', 'Givet', 'Revin'] },
          '09': { name: 'Ari√®ge', cities: ['Foix', 'Pamiers', 'Saint-Girons', 'Lavelanet', 'Tarascon-sur-Ari√®ge'] },
          '10': { name: 'Aube', cities: ['Troyes', 'Romilly-sur-Seine', 'La Chapelle-Saint-Luc', 'Saint-Andr√©-les-Vergers', 'Sainte-Savine'] },
          '11': { name: 'Aude', cities: ['Carcassonne', 'Narbonne', 'Castelnaudary', 'Limoux', 'L√©zignan-Corbi√®res'] },
          '12': { name: 'Aveyron', cities: ['Rodez', 'Millau', 'Villefranche-de-Rouergue', 'Decazeville', 'Onet-le-Ch√¢teau'] },
          '13': { name: 'Bouches-du-Rh√¥ne', cities: ['Marseille', 'Aix-en-Provence', 'Arles', 'Martigues', 'Aubagne'] },
          '14': { name: 'Calvados', cities: ['Caen', 'H√©rouville-Saint-Clair', 'Lisieux', 'Bayeux', 'Vire'] },
          '15': { name: 'Cantal', cities: ['Aurillac', 'Saint-Flour', 'Mauriac', 'Arpajon-sur-C√®re', 'Ytrac'] },
          '16': { name: 'Charente', cities: ['Angoul√™me', 'Cognac', 'Soyaux', 'La Couronne', 'Ruelle-sur-Touvre'] },
          '17': { name: 'Charente-Maritime', cities: ['La Rochelle', 'Rochefort', 'Saintes', 'Royan', 'Aytr√©'] },
          '18': { name: 'Cher', cities: ['Bourges', 'Vierzon', 'Saint-Amand-Montrond', 'Mehun-sur-Y√®vre', 'Saint-Doulchard'] },
          '19': { name: 'Corr√®ze', cities: ['Tulle', 'Brive-la-Gaillarde', 'Ussel', '√âgletons', 'Malemort-sur-Corr√®ze'] },
          '21': { name: 'C√¥te-d\'Or', cities: ['Dijon', 'Beaune', 'Chen√¥ve', 'Talant', 'Quetigny'] },
          '22': { name: 'C√¥tes-d\'Armor', cities: ['Saint-Brieuc', 'Lannion', 'Pl√©rin', 'Lamballe', 'Dinan'] },
          '23': { name: 'Creuse', cities: ['Gu√©ret', 'Aubusson', 'La Souterraine', 'Bourganeuf', 'Chambon-sur-Voueize'] },
          '24': { name: 'Dordogne', cities: ['P√©rigueux', 'Bergerac', 'Sarlat-la-Can√©da', 'Coulounieix-Chamiers', 'Tr√©lissac'] },
          '25': { name: 'Doubs', cities: ['Besan√ßon', 'Montb√©liard', 'Pontarlier', 'Audincourt', 'Valentigney'] },
          '26': { name: 'Dr√¥me', cities: ['Valence', 'Romans-sur-Is√®re', 'Mont√©limar', 'Pierrelatte', 'Bourg-l√®s-Valence'] },
          '27': { name: 'Eure', cities: ['√âvreux', 'Louviers', 'Vernon', 'Val-de-Reuil', 'Gisors'] },
          '28': { name: 'Eure-et-Loir', cities: ['Chartres', 'Dreux', 'Luc√©', 'Ch√¢teaudun', 'Mainvilliers'] },
          '29': { name: 'Finist√®re', cities: ['Brest', 'Quimper', 'Concarneau', 'Morlaix', 'Douarnenez'] },
          '2A': { name: 'Corse-du-Sud', cities: ['Ajaccio', 'Porto-Vecchio', 'Propriano', 'Sart√®ne', 'Bonifacio'] },
          '2B': { name: 'Haute-Corse', cities: ['Bastia', 'Corte', 'Calvi', 'L\'√éle-Rousse', 'Biguglia'] },
          '30': { name: 'Gard', cities: ['N√Æmes', 'Al√®s', 'Bagnols-sur-C√®ze', 'Beaucaire', 'Saint-Gilles'] },
          '31': { name: 'Haute-Garonne', cities: ['Toulouse', 'Colomiers', 'Tournefeuille', 'Muret', 'Blagnac'] },
          '32': { name: 'Gers', cities: ['Auch', 'Condom', 'Fleurance', 'L\'Isle-Jourdain', 'Mirande'] },
          '33': { name: 'Gironde', cities: ['Bordeaux', 'M√©rignac', 'Pessac', 'Talence', 'Villenave-d\'Ornon'] },
          '34': { name: 'H√©rault', cities: ['Montpellier', 'B√©ziers', 'S√®te', 'Lunel', 'Agde'] },
          '35': { name: 'Ille-et-Vilaine', cities: ['Rennes', 'Saint-Malo', 'Foug√®res', 'Vitr√©', 'Cesson-S√©vign√©'] },
          '36': { name: 'Indre', cities: ['Ch√¢teauroux', 'Issoudun', 'Le Blanc', 'La Ch√¢tre', 'Argenton-sur-Creuse'] },
          '37': { name: 'Indre-et-Loire', cities: ['Tours', 'Jou√©-l√®s-Tours', 'Saint-Pierre-des-Corps', 'Saint-Cyr-sur-Loire', 'Amboise'] },
          '38': { name: 'Is√®re', cities: ['Grenoble', 'Saint-Martin-d\'H√®res', 'Vienne', '√âchirolles', 'Bourgoin-Jallieu'] },
          '39': { name: 'Jura', cities: ['Lons-le-Saunier', 'Dole', 'Saint-Claude', 'Champagnole', 'Morez'] },
          '40': { name: 'Landes', cities: ['Mont-de-Marsan', 'Dax', 'Biscarrosse', 'Saint-Paul-l√®s-Dax', 'Tarnos'] },
          '41': { name: 'Loir-et-Cher', cities: ['Blois', 'Romorantin-Lanthenay', 'Vend√¥me', 'Vineuil', 'Saint-Gervais-la-For√™t'] },
          '42': { name: 'Loire', cities: ['Saint-√âtienne', 'Roanne', 'Saint-Chamond', 'Firminy', 'Montbrison'] },
          '43': { name: 'Haute-Loire', cities: ['Le Puy-en-Velay', 'Monistrol-sur-Loire', 'Yssingeaux', 'Brioude', 'Aurec-sur-Loire'] },
          '44': { name: 'Loire-Atlantique', cities: ['Nantes', 'Saint-Nazaire', 'Saint-Herblain', 'Rez√©', 'Saint-S√©bastien-sur-Loire'] },
          '45': { name: 'Loiret', cities: ['Orl√©ans', 'Fleury-les-Aubrais', 'Olivet', 'Saint-Jean-de-Braye', 'Ch√¢lette-sur-Loing'] },
          '46': { name: 'Lot', cities: ['Cahors', 'Figeac', 'Gourdon', 'Souillac', 'Prayssac'] },
          '47': { name: 'Lot-et-Garonne', cities: ['Agen', 'Villeneuve-sur-Lot', 'Marmande', 'Le Passage', 'N√©rac'] },
          '48': { name: 'Loz√®re', cities: ['Mende', 'Florac', 'Marvejols', 'Saint-Ch√©ly-d\'Apcher', 'Langogne'] },
          '49': { name: 'Maine-et-Loire', cities: ['Angers', 'Cholet', 'Saumur', 'Avrill√©', 'Les Ponts-de-C√©'] },
          '50': { name: 'Manche', cities: ['Saint-L√¥', 'Cherbourg-en-Cotentin', '√âqueurdreville-Hainneville', 'Tourlaville', 'Granville'] },
          '51': { name: 'Marne', cities: ['Reims', 'Ch√¢lons-en-Champagne', '√âpernay', 'Vitry-le-Fran√ßois', 'Tinqueux'] },
          '52': { name: 'Haute-Marne', cities: ['Chaumont', 'Saint-Dizier', 'Langres', 'Nogent', 'Joinville'] },
          '53': { name: 'Mayenne', cities: ['Laval', 'Mayenne', 'Ch√¢teau-Gontier', '√âvron', 'Chang√©'] },
          '54': { name: 'Meurthe-et-Moselle', cities: ['Nancy', 'Vand≈ìuvre-l√®s-Nancy', 'Lun√©ville', 'Toul', 'Villers-l√®s-Nancy'] },
          '55': { name: 'Meuse', cities: ['Bar-le-Duc', 'Verdun', 'Commercy', 'Saint-Mihiel', 'Stenay'] },
          '56': { name: 'Morbihan', cities: ['Vannes', 'Lorient', 'Lanester', 'Ploemeur', 'Hennebont'] },
          '57': { name: 'Moselle', cities: ['Metz', 'Thionville', 'Montigny-l√®s-Metz', 'Forbach', 'Sarreguemines'] },
          '58': { name: 'Ni√®vre', cities: ['Nevers', 'Cosne-Cours-sur-Loire', 'Varennes-Vauzelles', 'Decize', 'La Charit√©-sur-Loire'] },
          '59': { name: 'Nord', cities: ['Lille', 'Tourcoing', 'Roubaix', 'Dunkerque', 'Villeneuve-d\'Ascq'] },
          '60': { name: 'Oise', cities: ['Beauvais', 'Compi√®gne', 'Creil', 'Senlis', 'Nogent-sur-Oise'] },
          '61': { name: 'Orne', cities: ['Alen√ßon', 'Flers', 'Argentan', 'L\'Aigle', 'La Fert√©-Mac√©'] },
          '62': { name: 'Pas-de-Calais', cities: ['Arras', 'Boulogne-sur-Mer', 'Calais', 'Lens', 'Li√©vin'] },
          '63': { name: 'Puy-de-D√¥me', cities: ['Clermont-Ferrand', 'Riom', 'Cournon-d\'Auvergne', 'Chamali√®res', 'Issoire'] },
          '64': { name: 'Pyr√©n√©es-Atlantiques', cities: ['Pau', 'Bayonne', 'Anglet', 'Biarritz', 'Hendaye'] },
          '65': { name: 'Hautes-Pyr√©n√©es', cities: ['Tarbes', 'Lourdes', 'Bagn√®res-de-Bigorre', 'Aureilhan', 'Lannemezan'] },
          '66': { name: 'Pyr√©n√©es-Orientales', cities: ['Perpignan', 'Canet-en-Roussillon', 'Saint-Est√®ve', 'Argel√®s-sur-Mer', 'C√©ret'] },
          '67': { name: 'Bas-Rhin', cities: ['Strasbourg', 'Haguenau', 'Schiltigheim', 'Illkirch-Graffenstaden', 'S√©lestat'] },
          '68': { name: 'Haut-Rhin', cities: ['Mulhouse', 'Colmar', 'Saint-Louis', 'Wittenheim', 'Illzach'] },
          '69': { name: 'Rh√¥ne', cities: ['Lyon', 'Villeurbanne', 'V√©nissieux', 'Caluire-et-Cuire', 'Saint-Priest'] },
          '70': { name: 'Haute-Sa√¥ne', cities: ['Vesoul', 'Luxeuil-les-Bains', 'H√©ricourt', 'Lure', 'Gray'] },
          '71': { name: 'Sa√¥ne-et-Loire', cities: ['M√¢con', 'Chalon-sur-Sa√¥ne', 'Le Creusot', 'Montceau-les-Mines', 'Autun'] },
          '72': { name: 'Sarthe', cities: ['Le Mans', 'Sabl√©-sur-Sarthe', 'Allonnes', 'La Fl√®che', 'Coulaines'] },
          '73': { name: 'Savoie', cities: ['Chamb√©ry', 'Aix-les-Bains', 'Albertville', 'Saint-Jean-de-Maurienne', 'Montm√©lian'] },
          '74': { name: 'Haute-Savoie', cities: ['Annecy', 'Thonon-les-Bains', 'Annemasse', 'Cluses', '√âvian-les-Bains'] },
          '75': { name: 'Paris', cities: ['Paris'] },
          '76': { name: 'Seine-Maritime', cities: ['Rouen', 'Le Havre', 'Dieppe', 'Sotteville-l√®s-Rouen', 'Saint-√âtienne-du-Rouvray'] },
          '77': { name: 'Seine-et-Marne', cities: ['Meaux', 'Melun', 'Chelles', 'Pontault-Combault', 'Savigny-le-Temple'] },
          '78': { name: 'Yvelines', cities: ['Versailles', 'Sartrouville', 'Mantes-la-Jolie', 'Saint-Germain-en-Laye', 'Poissy'] },
          '79': { name: 'Deux-S√®vres', cities: ['Niort', 'Bressuire', 'Thouars', 'Parthenay', 'Saint-Maixent-l\'√âcole'] },
          '80': { name: 'Somme', cities: ['Amiens', 'Abbeville', 'Albert', 'P√©ronne', 'Montdidier'] },
          '81': { name: 'Tarn', cities: ['Albi', 'Castres', 'Gaillac', 'Graulhet', 'Mazamet'] },
          '82': { name: 'Tarn-et-Garonne', cities: ['Montauban', 'Castelsarrasin', 'Moissac', 'Caussade', 'Valence'] },
          '83': { name: 'Var', cities: ['Toulon', 'La Seyne-sur-Mer', 'Hy√®res', 'Fr√©jus', 'Draguignan'] },
          '84': { name: 'Vaucluse', cities: ['Avignon', 'Carpentras', 'Orange', 'Cavaillon', 'Apt'] },
          '85': { name: 'Vend√©e', cities: ['La Roche-sur-Yon', 'Les Sables-d\'Olonne', 'Challans', 'Fontenay-le-Comte', 'Lu√ßon'] },
          '86': { name: 'Vienne', cities: ['Poitiers', 'Ch√¢tellerault', 'Buxerolles', 'Loudun', 'Saint-Beno√Æt'] },
          '87': { name: 'Haute-Vienne', cities: ['Limoges', 'Saint-Junien', 'Panazol', 'Couzeix', 'Le Palais-sur-Vienne'] },
          '88': { name: 'Vosges', cities: ['√âpinal', 'Saint-Di√©-des-Vosges', 'G√©rardmer', 'Remiremont', 'Golbey'] },
          '89': { name: 'Yonne', cities: ['Auxerre', 'Sens', 'Joigny', 'Avallon', 'Migennes'] },
          '90': { name: 'Territoire de Belfort', cities: ['Belfort', 'Delle', 'Valdoie', 'Beaucourt', 'Danjoutin'] },
          '91': { name: 'Essonne', cities: ['√âvry-Courcouronnes', 'Corbeil-Essonnes', 'Massy', 'Savigny-sur-Orge', 'Sainte-Genevi√®ve-des-Bois'] },
          '92': { name: 'Hauts-de-Seine', cities: ['Nanterre', 'Boulogne-Billancourt', 'Colombes', 'Asni√®res-sur-Seine', 'Courbevoie'] },
          '93': { name: 'Seine-Saint-Denis', cities: ['Bobigny', 'Saint-Denis', 'Montreuil', 'Aubervilliers', 'Aulnay-sous-Bois'] },
          '94': { name: 'Val-de-Marne', cities: ['Cr√©teil', 'Vitry-sur-Seine', 'Champigny-sur-Marne', 'Saint-Maur-des-Foss√©s', 'Ivry-sur-Seine'] },
          '95': { name: 'Val-d\'Oise', cities: ['Cergy', 'Argenteuil', 'Sarcelles', 'Garges-l√®s-Gonesse', 'Franconville'] }
        };

        const VISIT_LEVELS = {
          never: { label: 'Jamais all√©', color: '#d1d5db', emoji: '‚ö™' },
          passed: { label: 'D√©j√† pass√©', color: '#f59e0b', emoji: 'üü°' },
          ate: { label: 'D√©j√† mang√©', color: '#10b981', emoji: 'üü¢' },
          slept: { label: 'D√©j√† dormi', color: '#8b5cf6', emoji: 'üü£' }
        };

        const REGIONS = {
          'Auvergne-Rh√¥ne-Alpes': ['01', '03', '07', '15', '26', '38', '42', '43', '63', '69', '73', '74'],
          'Bourgogne-Franche-Comt√©': ['21', '25', '39', '58', '70', '71', '89', '90'],
          'Bretagne': ['22', '29', '35', '56'],
          'Centre-Val de Loire': ['18', '28', '36', '37', '41', '45'],
          'Corse': ['2A', '2B'],
          'Grand Est': ['08', '10', '51', '52', '54', '55', '57', '67', '68', '88'],
          'Hauts-de-France': ['02', '59', '60', '62', '80'],
          '√éle-de-France': ['75', '77', '78', '91', '92', '93', '94', '95'],
          'Normandie': ['14', '27', '50', '61', '76'],
          'Nouvelle-Aquitaine': ['16', '17', '19', '23', '24', '33', '40', '47', '64', '79', '86', '87'],
          'Occitanie': ['09', '11', '12', '30', '31', '32', '34', '46', '48', '65', '66', '81', '82'],
          'Pays de la Loire': ['44', '49', '53', '72', '85'],
          'Provence-Alpes-C√¥te d\'Azur': ['04', '05', '06', '13', '83', '84']
        };

        const REGION_COLORS = {
          'Auvergne-Rh√¥ne-Alpes': { r: 52, g: 152, b: 219 },      // Bleu
          'Bourgogne-Franche-Comt√©': { r: 155, g: 89, b: 182 },   // Violet
          'Bretagne': { r: 46, g: 204, b: 113 },                  // Vert
          'Centre-Val de Loire': { r: 241, g: 196, b: 15 },       // Jaune
          'Corse': { r: 230, g: 126, b: 34 },                     // Orange
          'Grand Est': { r: 231, g: 76, b: 60 },                  // Rouge
          'Hauts-de-France': { r: 52, g: 73, b: 94 },             // Bleu fonc√©
          '√éle-de-France': { r: 149, g: 165, b: 166 },            // Gris
          'Normandie': { r: 26, g: 188, b: 156 },                 // Turquoise
          'Nouvelle-Aquitaine': { r: 142, g: 68, b: 173 },        // Pourpre
          'Occitanie': { r: 243, g: 156, b: 18 },                 // Orange dor√©
          'Pays de la Loire': { r: 22, g: 160, b: 133 },          // Vert sarcelle
          'Provence-Alpes-C√¥te d\'Azur': { r: 211, g: 84, b: 0 }  // Orange br√ªl√©
        };

        // Helper function to get region for a department
        const getDepartmentRegion = (code) => {
          for (const [region, depts] of Object.entries(REGIONS)) {
            if (depts.includes(code)) return region;
          }
          return null;
        };

        // Helper function to calculate color based on visit percentage
        const getDepartmentColor = (code, state) => {
          const region = getDepartmentRegion(code);
          if (!region || !REGION_COLORS[region]) {
            return '#cccccc'; // Fallback color
          }

          const baseColor = REGION_COLORS[region];
          const totalCities = (departmentInfo[code]?.cities?.length || 5) + (state?.customCities?.length || 0);
          const visitedCount = state?.visitedCities?.length || 0;
          const visitPercent = totalCities > 0 ? visitedCount / totalCities : 0;

          // Gradually increase intensity from 0% to 100% visited
          // At 0% visited: light but visible (70% lightness) - couleur terne mais visible
          // At 100% visited: full color intensity (0% lightness) - couleur pleine et vive
          const lightness = 0.7 * (1 - visitPercent);
          const r = Math.round(baseColor.r + (255 - baseColor.r) * lightness);
          const g = Math.round(baseColor.g + (255 - baseColor.g) * lightness);
          const b = Math.round(baseColor.b + (255 - baseColor.b) * lightness);

          return `rgb(${r}, ${g}, ${b})`;
        };

        function FranceMap() {
          const [geoData, setGeoData] = useState(null);
          const [loading, setLoading] = useState(true);
          const [appState, setAppState] = useState(() => {
            const saved = localStorage.getItem('franceMapCityVisits');
            if (saved) return JSON.parse(saved);

            // Initialize state with cityVisits for each department
            const initialState = {};
            Object.keys(departmentInfo).forEach(code => {
              initialState[code] = {
                cityVisits: {} // { cityName: 'never' | 'passed' | 'ate' | 'slept' }
              };
            });
            return initialState;
          });

          useEffect(() => {
            localStorage.setItem('franceMapCityVisits', JSON.stringify(appState));
          }, [appState]);

          const [modalOpen, setModalOpen] = useState(false);
          const [currentDepartment, setCurrentDepartment] = useState(null);
          const [activeTab, setActiveTab] = useState('map');
          const [mapZoom, setMapZoom] = useState(1);
          const [mapPan, setMapPan] = useState({ x: 0, y: 0 });

          useEffect(() => {
            fetch(GEOJSON_URL)
              .then(res => res.json())
              .then(data => {
                setGeoData(data);
                setLoading(false);
              })
              .catch(err => {
                console.error('Erreur chargement GeoJSON:', err);
                setLoading(false);
              });
          }, []);

          const openModal = (code) => {
            setCurrentDepartment(code);
            setModalOpen(true);
          };

          const closeModal = () => {
            setModalOpen(false);
            setCurrentDepartment(null);
          };

          const updateCityVisit = (departmentCode, cityName, visitLevel) => {
            setAppState(prev => ({
              ...prev,
              [departmentCode]: {
                ...prev[departmentCode],
                cityVisits: {
                  ...prev[departmentCode].cityVisits,
                  [cityName]: visitLevel
                }
              }
            }));
          };

          const convertToSVGPath = (coordinates, bounds) => {
            const paths = [];
            
            const projectPoint = ([lon, lat]) => {
              const x = ((lon - bounds.minLon) / (bounds.maxLon - bounds.minLon)) * 1000;
              const y = ((bounds.maxLat - lat) / (bounds.maxLat - bounds.minLat)) * 1100;
              return [x, y];
            };

            const processRing = (ring) => {
              const projected = ring.map(projectPoint);
              return 'M ' + projected.map(p => p.join(',')).join(' L ') + ' Z';
            };

            if (coordinates[0] && Array.isArray(coordinates[0][0]) && Array.isArray(coordinates[0][0][0])) {
              coordinates.forEach(polygon => {
                polygon.forEach(ring => {
                  paths.push(processRing(ring));
                });
              });
            } else if (coordinates[0] && Array.isArray(coordinates[0][0])) {
              coordinates.forEach(ring => {
                paths.push(processRing(ring));
              });
            }

            return paths.join(' ');
          };

          const getBounds = (departmentCode = null) => {
            if (!geoData) return null;

            let minLon = Infinity, maxLon = -Infinity;
            let minLat = Infinity, maxLat = -Infinity;

            const processCoords = (c) => {
              if (Array.isArray(c[0])) {
                c.forEach(processCoords);
              } else {
                const [lon, lat] = c;
                minLon = Math.min(minLon, lon);
                maxLon = Math.max(maxLon, lon);
                minLat = Math.min(minLat, lat);
                maxLat = Math.max(maxLat, lat);
              }
            };

            if (departmentCode) {
              // Get bounds for specific department
              const feature = geoData.features.find(f => f.properties.code === departmentCode);
              if (feature) {
                processCoords(feature.geometry.coordinates);
              }
            } else {
              // Get bounds for all of France
              geoData.features.forEach(feature => {
                processCoords(feature.geometry.coordinates);
              });
            }

            return { minLon, maxLon, minLat, maxLat };
          };

          if (loading) {
            return (
              <div className="flex items-center justify-center min-h-screen">
                <div className="text-2xl text-gray-600">Chargement de la carte...</div>
              </div>
            );
          }

          if (!geoData) {
            return (
              <div className="flex items-center justify-center min-h-screen">
                <div className="text-xl text-red-600">Erreur de chargement de la carte</div>
              </div>
            );
          }

          const bounds = getBounds();

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
              <div className="p-4 md:p-8">
                <div className="max-w-[1600px] mx-auto">
                  {!currentDepartment && (
                    <MapView
                      geoData={geoData}
                      bounds={bounds}
                      appState={appState}
                      convertToSVGPath={convertToSVGPath}
                      openModal={openModal}
                      mapZoom={mapZoom}
                      setMapZoom={setMapZoom}
                      mapPan={mapPan}
                      setMapPan={setMapPan}
                    />
                  )}
                </div>
              </div>

              {modalOpen && currentDepartment && (
                <DepartmentOverlay
                  code={currentDepartment}
                  department={departmentInfo[currentDepartment]}
                  state={appState[currentDepartment]}
                  onClose={closeModal}
                  onUpdateCityVisit={updateCityVisit}
                  geoData={geoData}
                  bounds={bounds}
                  getBounds={getBounds}
                  convertToSVGPath={convertToSVGPath}
                  getDepartmentColor={getDepartmentColor}
                />
              )}
            </div>
          );
        }

        function TabButton({ active, onClick, children }) {
          return (
            <button
              onClick={onClick}
              className={`px-6 py-3 font-semibold transition-all whitespace-nowrap ${
                active 
                  ? 'bg-blue-500 text-white border-b-4 border-blue-700' 
                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
              }`}
            >
              {children}
            </button>
          );
        }

        function MapView({ geoData, bounds, appState, convertToSVGPath, openModal, mapZoom, setMapZoom, mapPan, setMapPan }) {
          const svgRef = React.useRef(null);
          const [tooltip, setTooltip] = useState({ visible: false, name: '', x: 0, y: 0 });

          React.useEffect(() => {
            const svg = svgRef.current;
            if (!svg) return;

            const handleWheel = (e) => {
              e.preventDefault();
              const delta = e.deltaY > 0 ? 0.9 : 1.1;
              setMapZoom(prev => Math.max(1, Math.min(5, prev * delta)));
            };

            svg.addEventListener('wheel', handleWheel, { passive: false });
            return () => svg.removeEventListener('wheel', handleWheel);
          }, [setMapZoom]);

          const handleReset = () => {
            setMapZoom(1);
            setMapPan({ x: 0, y: 0 });
          };

          const handleDepartmentMouseEnter = (e, code) => {
            const deptName = departmentInfo[code]?.name;
            setTooltip({
              visible: true,
              name: `${deptName} (${code})`,
              x: e.clientX,
              y: e.clientY
            });
          };

          const handleDepartmentMouseMove = (e) => {
            setTooltip(prev => ({
              ...prev,
              x: e.clientX,
              y: e.clientY
            }));
          };

          const handleDepartmentMouseLeave = () => {
            setTooltip({ visible: false, name: '', x: 0, y: 0 });
          };

          return (
            <>
              <header className="text-center mb-10">
                <h1 className="text-5xl md:text-6xl font-bold text-gray-800 mb-3">
                  üó∫Ô∏è Carte Interactive de France
                </h1>
                <p className="text-lg text-gray-600">
                  Explorez les d√©partements fran√ßais ¬∑ Cliquez pour agrandir
                </p>
              </header>

              <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-10 mb-8 map-container">
                {mapZoom > 1 && (
                  <div className="mb-4 flex items-center gap-4">
                    <button
                      onClick={handleReset}
                      className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                    >
                      R√©initialiser le zoom
                    </button>
                    <span className="text-sm text-gray-600">Zoom: {mapZoom.toFixed(1)}x</span>
                  </div>
                )}
                <svg
                  ref={svgRef}
                  viewBox="0 0 1000 1100"
                  className="w-full h-auto"
                  style={{ minHeight: '600px', cursor: mapZoom > 1 ? 'grab' : 'default' }}
                >
                  <defs>
                    {/* Gradient for water/ocean effect */}
                    <linearGradient id="oceanGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style={{ stopColor: '#e0f2fe', stopOpacity: 1 }} />
                      <stop offset="100%" style={{ stopColor: '#bae6fd', stopOpacity: 1 }} />
                    </linearGradient>
                    {/* Shadow filter */}
                    <filter id="departmentShadow" x="-50%" y="-50%" width="200%" height="200%">
                      <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
                      <feOffset dx="0" dy="1" result="offsetblur"/>
                      <feComponentTransfer>
                        <feFuncA type="linear" slope="0.3"/>
                      </feComponentTransfer>
                      <feMerge>
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/>
                      </feMerge>
                    </filter>
                  </defs>
                  
                  {/* Ocean background */}
                  <rect x="0" y="0" width="1000" height="1100" fill="url(#oceanGradient)" opacity="0.3"/>

                  <g transform={`translate(${500 - 500 * mapZoom + mapPan.x}, ${550 - 550 * mapZoom + mapPan.y}) scale(${mapZoom})`}>
                  <g id="departments">
                    {geoData.features.map(feature => {
                      const code = feature.properties.code;
                      const path = convertToSVGPath(feature.geometry.coordinates, bounds);
                      const state = appState[code];

                      return (
                        <g key={code}>
                          <path
                            d={path}
                            fill={getDepartmentColor(code, state)}
                            stroke="#fff"
                            strokeWidth="2"
                            className="department-path"
                            filter="url(#departmentShadow)"
                            onClick={() => openModal(code)}
                            onMouseEnter={(e) => handleDepartmentMouseEnter(e, code)}
                            onMouseMove={handleDepartmentMouseMove}
                            onMouseLeave={handleDepartmentMouseLeave}
                          />
                        </g>
                      );
                    })}
                  </g>
                  </g>
                </svg>

                {/* Tooltip */}
                {tooltip.visible && (
                  <div
                    className="department-tooltip"
                    style={{
                      left: `${tooltip.x + 15}px`,
                      top: `${tooltip.y + 15}px`
                    }}
                  >
                    {tooltip.name}
                  </div>
                )}

                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                  <h3 className="font-semibold text-gray-800 mb-3">L√©gende</h3>
                  <div className="space-y-4">
                    {/* Region colors */}
                    <div>
                      <p className="text-sm font-medium text-gray-700 mb-2">Couleurs par r√©gion :</p>
                      <div className="flex flex-wrap gap-3">
                        {Object.entries(REGION_COLORS).map(([region, color]) => (
                          <div key={region} className="flex items-center gap-2">
                            <div
                              className="w-6 h-6 rounded border border-gray-300"
                              style={{ backgroundColor: `rgb(${color.r}, ${color.g}, ${color.b})` }}
                            />
                            <span className="text-xs text-gray-600">{region}</span>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Intensity explanation */}
                    <div>
                      <p className="text-sm font-medium text-gray-700 mb-2">Intensit√© de couleur :</p>
                      <div className="flex items-center gap-2">
                        <div className="flex items-center gap-1">
                          <div className="w-8 h-6 rounded border border-gray-300" style={{ backgroundColor: 'rgb(230, 230, 250)' }} />
                          <span className="text-xs text-gray-600">0%</span>
                        </div>
                        <span className="text-gray-400">‚Üí</span>
                        <div className="flex items-center gap-1">
                          <div className="w-8 h-6 rounded border border-gray-300" style={{ backgroundColor: 'rgb(52, 152, 219)' }} />
                          <span className="text-xs text-gray-600">100%</span>
                        </div>
                        <span className="text-xs text-gray-500 ml-2">(% villes visit√©es)</span>
                      </div>
                    </div>

                    {/* City markers */}
                    <div>
                      <div className="flex items-center gap-2">
                        <div className="w-3 h-3 rounded-full bg-red-500 border-2 border-white" />
                        <span className="text-sm text-gray-600">Villes visit√©es</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </>
          );
        }

        function StatsView({ appState, stats }) {
          const regionStats = Object.entries(REGIONS).map(([region, depts]) => {
            const visited = depts.filter(code => appState[code]?.visitLevel !== 'unvisited').length;
            const total = depts.length;
            const percent = Math.round((visited / total) * 100);
            
            return { region, visited, total, percent };
          }).sort((a, b) => b.percent - a.percent);

          const topRated = Object.entries(appState)
            .filter(([_, state]) => state.rating > 0)
            .sort((a, b) => b[1].rating - a[1].rating)
            .slice(0, 10);

          const ratingDistribution = [1, 2, 3, 4, 5].map(rating => ({
            rating,
            count: Object.values(appState).filter(s => s.rating === rating).length
          }));

          return (
            <div className="space-y-8">
              <h2 className="text-3xl font-bold text-gray-800">üìä Statistiques d√©taill√©es</h2>

              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <StatCard title="D√©partements visit√©s" value={`${stats.totalVisited}/96`} subtitle={`${stats.percentVisited}% de la France`} />
                <StatCard title="R√©gions compl√®tes" value={`${stats.regionsCompleted}/13`} subtitle="Toutes visit√©es" />
                <StatCard title="Note moyenne" value={stats.avgRating} subtitle={`‚≠ê sur 5 (${stats.ratedCount} not√©s)`} />
              </div>

              <div className="grid md:grid-cols-2 gap-6">
                {/* Progression par r√©gion */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">Progression par r√©gion</h3>
                  <div className="space-y-3 max-h-96 overflow-y-auto">
                    {regionStats.map(({ region, visited, total, percent }) => (
                      <div key={region}>
                        <div className="flex justify-between text-sm mb-1">
                          <span className="font-medium">{region}</span>
                          <span className="text-gray-600">{visited}/{total} ({percent}%)</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                          <div 
                            className={`h-2 rounded-full transition-all ${
                              percent === 100 ? 'bg-green-500' : 'bg-blue-500'
                            }`}
                            style={{ width: `${percent}%` }}
                          />
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Distribution des notes */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">Distribution des notes</h3>
                  <div className="space-y-3">
                    {ratingDistribution.reverse().map(({ rating, count }) => (
                      <div key={rating} className="flex items-center gap-4">
                        <span className="w-16 text-sm font-medium">{'‚≠ê'.repeat(rating)}</span>
                        <div className="flex-1 bg-gray-200 rounded-full h-6">
                          <div 
                            className="bg-yellow-500 h-6 rounded-full flex items-center justify-end pr-2"
                            style={{ width: `${stats.ratedCount > 0 ? (count / stats.ratedCount) * 100 : 0}%` }}
                          >
                            {count > 0 && <span className="text-xs font-bold text-white">{count}</span>}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Top 10 Rated */}
              <div className="bg-white rounded-lg shadow-md p-6">
                <h3 className="text-xl font-bold text-gray-800 mb-4">üèÜ Top 10 - Mieux not√©s</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  {topRated.map(([code, state], idx) => (
                    <div key={code} className="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-50 to-white rounded-lg border border-yellow-200">
                      <div className="flex items-center gap-3">
                        <span className="text-2xl font-bold text-yellow-600">#{idx + 1}</span>
                        <div>
                          <div className="font-bold">{departmentInfo[code]?.name}</div>
                          <div className="text-sm text-gray-600">{code}</div>
                        </div>
                      </div>
                      <span className="text-2xl">{'‚≠ê'.repeat(state.rating)}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          );
        }

        function StatItem({ number, label, sublabel }) {
          return (
            <div className="text-center">
              <div className="text-2xl md:text-3xl font-bold text-blue-600">{number}</div>
              <div className="text-xs md:text-sm text-gray-600">{label}</div>
              {sublabel && <div className="text-xs text-gray-500">{sublabel}</div>}
            </div>
          );
        }

        function StatCard({ title, value, subtitle }) {
          return (
            <div className="bg-white rounded-lg shadow-md p-6">
              <h3 className="text-sm font-semibold text-gray-600 mb-2">{title}</h3>
              <div className="text-3xl font-bold text-blue-600">{value}</div>
              {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
            </div>
          );
        }

        function DepartmentOverlay({ code, department, state, onClose, onUpdateCityVisit, geoData, bounds, getBounds, convertToSVGPath, getDepartmentColor }) {
          // Get all cities that have GPS coordinates
          const allAvailableCities = department.cities.filter(city => CITY_COORDINATES[city]);
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedCity, setSelectedCity] = useState(null);

          // Filter cities based on search
          const filteredCities = searchTerm
            ? allAvailableCities.filter(city =>
                city.toLowerCase().includes(searchTerm.toLowerCase())
              )
            : allAvailableCities;

          const getCityVisitLevel = (cityName) => {
            return state?.cityVisits?.[cityName] || 'never';
          };

          const handleCityClick = (cityName) => {
            setSelectedCity(cityName);
          };

          const handleSetVisitLevel = (cityName, level) => {
            onUpdateCityVisit(code, cityName, level);
            setSelectedCity(null);
          };

          // Get department bounding box for zoomed view
          const departmentFeature = geoData.features.find(f => f.properties.code === code);
          if (!departmentFeature) return null;

          // Calculate zoomed bounds for this department
          const deptBounds = getBounds(code);
          if (!deptBounds) return null;

          // Add padding around department (20%)
          const lonPadding = (deptBounds.maxLon - deptBounds.minLon) * 0.2;
          const latPadding = (deptBounds.maxLat - deptBounds.minLat) * 0.2;
          const zoomedBounds = {
            minLon: deptBounds.minLon - lonPadding,
            maxLon: deptBounds.maxLon + lonPadding,
            minLat: deptBounds.minLat - latPadding,
            maxLat: deptBounds.maxLat + latPadding
          };

          return (
            <div className="department-overlay" onClick={onClose}>
              <div className="department-map-full" onClick={(e) => e.stopPropagation()}>
                {/* Header with close button */}
                <div className="flex justify-between items-center mb-4">
                  <div>
                    <h2 className="text-4xl font-bold text-gray-800">
                      {department.name}
                    </h2>
                    <p className="text-lg text-gray-500 mt-1">{code} ¬∑ {allAvailableCities.length} villes disponibles</p>
                  </div>
                  <button
                    onClick={onClose}
                    className="text-gray-400 hover:text-gray-600 text-5xl font-light leading-none transition-colors"
                  >
                    √ó
                  </button>
                </div>

                {/* Legend */}
                <div className="mb-4 p-3 bg-gray-50 rounded-xl">
                  <p className="text-sm font-semibold text-gray-700 mb-2">Cliquez sur une ville pour indiquer votre visite :</p>
                  <div className="flex flex-wrap gap-3">
                    {Object.entries(VISIT_LEVELS).map(([level, { label, emoji, color }]) => (
                      <div key={level} className="flex items-center gap-1.5">
                        <div className="w-4 h-4 rounded-full border-2 border-white shadow" style={{ backgroundColor: color }} />
                        <span className="text-xs text-gray-600">{emoji} {label}</span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Search bar */}
                <div className="mb-4">
                  <input
                    type="text"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                    placeholder="Rechercher une ville..."
                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none text-lg"
                    onClick={(e) => e.stopPropagation()}
                  />
                  {searchTerm && (
                    <p className="text-sm text-gray-500 mt-2">
                      {filteredCities.length} ville{filteredCities.length !== 1 ? 's' : ''} trouv√©e{filteredCities.length !== 1 ? 's' : ''}
                    </p>
                  )}
                </div>

                {/* Department map */}
                <div className="flex-1 relative bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-6 shadow-inner" style={{ minHeight: '400px' }}>
                    {(() => {
                      // Calculate SVG coordinates of the department
                      const projectPoint = ([lon, lat]) => {
                        const x = ((lon - zoomedBounds.minLon) / (zoomedBounds.maxLon - zoomedBounds.minLon)) * 1000;
                        const y = ((zoomedBounds.maxLat - lat) / (zoomedBounds.maxLat - zoomedBounds.minLat)) * 1100;
                        return [x, y];
                      };

                      // Get all coordinates to find SVG bounding box
                      let minX = Infinity, maxX = -Infinity;
                      let minY = Infinity, maxY = -Infinity;

                      const processCoords = (coords) => {
                        if (Array.isArray(coords[0])) {
                          coords.forEach(processCoords);
                        } else {
                          const [x, y] = projectPoint(coords);
                          minX = Math.min(minX, x);
                          maxX = Math.max(maxX, x);
                          minY = Math.min(minY, y);
                          maxY = Math.max(maxY, y);
                        }
                      };

                      processCoords(departmentFeature.geometry.coordinates);

                      // Add padding
                      const padding = 50;
                      const viewBoxX = minX - padding;
                      const viewBoxY = minY - padding;
                      const viewBoxWidth = (maxX - minX) + (padding * 2);
                      const viewBoxHeight = (maxY - minY) + (padding * 2);
                      const viewBox = `${viewBoxX} ${viewBoxY} ${viewBoxWidth} ${viewBoxHeight}`;

                      const path = convertToSVGPath(departmentFeature.geometry.coordinates, zoomedBounds);

                      return (
                        <svg viewBox={viewBox} className="w-full h-full" preserveAspectRatio="xMidYMid meet">
                          <defs>
                            {/* Gradient for city markers */}
                            <radialGradient id="cityGradient">
                              <stop offset="0%" stopColor="#ef4444" />
                              <stop offset="100%" stopColor="#dc2626" />
                            </radialGradient>
                            {/* Glow effect */}
                            <filter id="glow">
                              <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                              <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                              </feMerge>
                            </filter>
                          </defs>

                          {/* Department shape */}
                          <path
                            d={path}
                            fill={getDepartmentColor(code, state)}
                            stroke="#1f2937"
                            strokeWidth="5"
                            opacity="0.95"
                          />

                          {/* City markers */}
                          {filteredCities.map((city) => {
                            const [lon, lat] = CITY_COORDINATES[city];
                            const [cityX, cityY] = projectPoint([lon, lat]);
                            const visitLevel = getCityVisitLevel(city);
                            const levelColor = VISIT_LEVELS[visitLevel].color;
                            const isSelected = selectedCity === city;

                            return (
                              <g key={city} style={{ cursor: 'pointer' }} onClick={() => handleCityClick(city)}>
                                {/* City marker */}
                                <circle
                                  cx={cityX}
                                  cy={cityY}
                                  r={isSelected ? "20" : "16"}
                                  fill={levelColor}
                                  stroke={isSelected ? "#000" : "#fff"}
                                  strokeWidth={isSelected ? "6" : "4"}
                                  opacity="0.95"
                                  style={{ transition: 'all 0.3s ease' }}
                                />
                                {/* City name - only show if less than 15 cities or search is active */}
                                {(filteredCities.length <= 15 || searchTerm) && (
                                  <text
                                    x={cityX}
                                    y={cityY + 35}
                                    textAnchor="middle"
                                    className="city-label"
                                  >
                                    {city}
                                  </text>
                                )}
                                {/* Show title for all cities */}
                                <title>{city} - {VISIT_LEVELS[visitLevel].label}</title>
                              </g>
                            );
                          })}
                        </svg>
                      );
                    })()}
                  </div>

                  {/* Visit level selector */}
                  {selectedCity && (
                    <div className="mt-4 p-4 bg-white rounded-xl shadow-lg border-2 border-blue-500">
                      <h3 className="font-bold text-lg text-gray-800 mb-3 text-center">
                        {selectedCity}
                      </h3>
                      <div className="grid grid-cols-2 gap-2">
                        {Object.entries(VISIT_LEVELS).map(([level, { label, emoji, color }]) => (
                          <button
                            key={level}
                            onClick={() => handleSetVisitLevel(selectedCity, level)}
                            className={`px-4 py-3 rounded-lg font-semibold transition-all text-white ${
                              getCityVisitLevel(selectedCity) === level
                                ? 'ring-4 ring-blue-400 scale-105'
                                : 'hover:scale-105'
                            }`}
                            style={{ backgroundColor: color }}
                          >
                            <span className="text-2xl mr-2">{emoji}</span>
                            <span>{label}</span>
                          </button>
                        ))}
                      </div>
                      <button
                        onClick={() => setSelectedCity(null)}
                        className="mt-3 w-full py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                      >
                        Annuler
                      </button>
                    </div>
                  )}

                  {/* Close hint */}
                  <p className="text-center text-gray-500 mt-4 text-sm">
                    Cliquez n'importe o√π pour revenir √† la carte
                  </p>
                </div>
              </div>
          );
        }

        function DepartmentModal({ code, department, state, onClose, onUpdate, geoData, bounds, convertToSVGPath, getDepartmentColor }) {
          const [visitLevel, setVisitLevel] = useState(state.visitLevel);
          const [visitedCities, setVisitedCities] = useState(state.visitedCities);
          const [customCities, setCustomCities] = useState(state.customCities);
          const [notes, setNotes] = useState(state.notes);
          const [newCity, setNewCity] = useState('');
          const [rating, setRating] = useState(state.rating || 0);

          const toggleCity = (city) => {
            setVisitedCities(prev =>
              prev.includes(city) ? prev.filter(c => c !== city) : [...prev, city]
            );
          };

          const addCity = () => {
            if (newCity.trim() && !customCities.includes(newCity.trim())) {
              setCustomCities(prev => [...prev, newCity.trim()]);
              setNewCity('');
            }
          };

          const handleSave = () => {
            onUpdate({
              visitLevel,
              visitedCities,
              customCities,
              notes,
              rating
            });
            onClose();
          };

          const allCities = [...department.cities, ...customCities];

          return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 overflow-y-auto" onClick={onClose}>
              <div className="bg-white rounded-2xl shadow-2xl w-full max-w-3xl my-8" onClick={(e) => e.stopPropagation()}>
                <div className="flex justify-between items-center p-6 border-b sticky top-0 bg-white rounded-t-2xl z-10">
                  <h2 className="text-2xl font-bold text-gray-800">
                    {department.name} ({code})
                  </h2>
                  <button
                    onClick={onClose}
                    className="text-gray-400 hover:text-gray-600 text-3xl font-bold leading-none"
                  >
                    √ó
                  </button>
                </div>

                <div className="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
                  {/* Department Map */}
                  {geoData && bounds && (
                    <div className="bg-gray-100 rounded-lg p-4">
                      <h3 className="font-semibold text-gray-700 mb-3 text-lg">Carte du d√©partement</h3>
                      <div className="bg-white rounded-lg p-4 shadow-inner">
                        <svg viewBox="0 0 1000 1100" className="w-full h-auto" style={{ maxHeight: '300px' }}>
                          {/* Department shape */}
                          {geoData.features
                            .filter(feature => feature.properties.code === code)
                            .map(feature => {
                              const path = convertToSVGPath(feature.geometry.coordinates, bounds);
                              return (
                                <path
                                  key={code}
                                  d={path}
                                  fill={getDepartmentColor(code, state)}
                                  stroke="#333"
                                  strokeWidth="3"
                                  opacity="0.7"
                                />
                              );
                            })}

                          {/* City markers */}
                          {visitedCities.map(city => {
                            if (!CITY_COORDINATES[city]) return null;
                            const [lon, lat] = CITY_COORDINATES[city];
                            const cityX = ((lon - bounds.minLon) / (bounds.maxLon - bounds.minLon)) * 1000;
                            const cityY = ((bounds.maxLat - lat) / (bounds.maxLat - bounds.minLat)) * 1100;

                            return (
                              <g key={city}>
                                <circle
                                  cx={cityX}
                                  cy={cityY}
                                  r="8"
                                  fill="#e74c3c"
                                  stroke="#fff"
                                  strokeWidth="3"
                                />
                                <title>{city}</title>
                              </g>
                            );
                          })}
                        </svg>
                      </div>
                    </div>
                  )}

                  {/* Rating */}
                  <div>
                    <label className="block font-semibold text-gray-700 mb-3 text-lg">
                      Note {rating > 0 && <span className="text-gray-600">({rating}/5)</span>}
                    </label>
                    <div className="flex items-center gap-2">
                      {[1, 2, 3, 4, 5].map(star => (
                        <button
                          key={star}
                          onClick={() => setRating(star === rating ? 0 : star)}
                          className="text-4xl transition-all hover:scale-110"
                        >
                          {star <= rating ? '‚≠ê' : '‚òÜ'}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Visit Level */}
                  <div>
                    <label className="block font-semibold text-gray-700 mb-3 text-lg">Niveau de visite</label>
                    <div className="grid grid-cols-2 gap-3">
                      {Object.entries(VISIT_LEVELS).map(([key, { label }]) => (
                        <button
                          key={key}
                          onClick={() => setVisitLevel(key)}
                          className={`p-3 rounded-lg border-2 font-medium transition-all ${
                            visitLevel === key
                              ? 'bg-blue-500 text-white border-blue-500'
                              : 'bg-white text-gray-700 border-gray-300 hover:border-blue-300'
                          }`}
                        >
                          {label}
                        </button>
                      ))}
                    </div>
                  </div>

                  {/* Cities */}
                  <div>
                    <h3 className="font-semibold text-gray-700 mb-3 text-lg">Villes visit√©es</h3>
                    <div className="flex flex-wrap gap-2 mb-4">
                      {allCities.map(city => (
                        <button
                          key={city}
                          onClick={() => toggleCity(city)}
                          className={`px-4 py-2 rounded-full transition-all flex items-center gap-2 ${
                            visitedCities.includes(city)
                              ? 'bg-blue-500 text-white'
                              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                          }`}
                        >
                          {visitedCities.includes(city) && <span className="font-bold">‚úì</span>}
                          <span>{city}</span>
                        </button>
                      ))}
                    </div>
                    <div className="flex gap-2">
                      <input
                        type="text"
                        value={newCity}
                        onChange={(e) => setNewCity(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && addCity()}
                        placeholder="Ajouter une ville..."
                        className="flex-1 px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                      />
                      <button
                        onClick={addCity}
                        className="px-6 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600"
                      >
                        +
                      </button>
                    </div>
                  </div>

                  {/* Notes */}
                  <div>
                    <label className="block font-semibold text-gray-700 mb-3 text-lg">Notes de voyage üìù</label>
                    <textarea
                      value={notes}
                      onChange={(e) => setNotes(e.target.value)}
                      placeholder="Ajoutez vos souvenirs, anecdotes, recommandations..."
                      className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none resize-none"
                      rows={5}
                    />
                  </div>

                  <button
                    onClick={handleSave}
                    className="w-full py-4 bg-blue-500 text-white font-bold text-lg rounded-lg hover:bg-blue-600 transition-colors"
                  >
                    üíæ Enregistrer
                  </button>
                </div>
              </div>
            </div>
          );
        }

        ReactDOM.render(<FranceMap />, document.getElementById('root'));
    </script>
</body>
</html>
